# 取り組んだ課題一覧
- REST
# わかったこと
## データフォーマット 
    主なデータフォーマット
  - XML
      タグで囲まれたテキスト形式
  - JSON
    JSを元にしたテキスト形式、XMLに比べデータ量が減らせる
  - JSONP
    クロスドメイン(ホームページを表示したときに、複数の場所（ドメイン）からデータを持ってくるようになっている状態のこと)でデータの受け渡しが可能なJSON

## データ内部構成の設計
- ヘッダ情報と情報が重複するのでエンベロープは使わない
- オブジェクトはフラットにする
- ページネーションをサポートする情報を返す
- 日付はRFC3339を用いる
- 大きな数値(64bit整数...jsで処理できないぐらいの大きさ)は文字列で返す、通常の整数は32bitで返却しよう
## エラー表現の設計
- エラー詳細はレスポンスボディに格納する。
- エラー発生の際はHTMLが返却されないようにする(Content-Typeはエラーであってもjson等で返却しよう)
- サービス閉塞時は403ではなく503 + Retry-After(いつ再開するかの見込み)を返却する
## API versionの表現設計
- APIにバージョンを含める場合
    メリット：特定バージョンを指定しているので突然エラーが発生しにくい
    デメリット：複数バージョンを並列処理するため管理が複雑になる。
- APIバージョンを格納するパターンは３種類存在するが、パスの場合が多い。REST的にURLはリソースなので、設計上はヘッダにサービス固有の接頭時をつけて格納するのがよろしい。
- バージョンの付け方はセマンティックバージョニング(x.x.x)がメジャー
## OAuthとOpenID Connect
ユーザとクライアントアプリ,リソースサーバが存在する際、クライアントアプリ側にアクセストークンを発行し、クライアントアプリ側からのリクエストに対して情報の認可を行う仕組み。
OAuth = 認可,OpenID Connect = OAuth + 本人情報取得。いずれもFlowが存在する
### 認証と認可
認証=誰であるか...本人特定、認可=アクセスして良いかわるいか...アクセス制限  
### Json Web Token(JWT)
認証結果をサーバサイドで保存せずクライアントサイドで保持する際に用いる。
署名による改ざんチェック、URL-Safeなデータ、データ構造はJSONの３点が特徴である。
ヘッダ.ペイロード.署名で構成される。
### 大量アクセス対策(rate limit)
考慮すること
- 誰に対して
APIキー、user ID等で識別
- 何に対して
単一機能、機能群、API全体等
- 制限回数
- リセットまでの単位時間(window) 
### キャッシュ制御
キャッシュ制御に利用するヘッダは２分類３パターン
- キャッシュさせる方法 
    - 分類 
        有効期限による制御(Expires,cache-control + Date)、検証による制御(Last-modified + ETag)
- Expiresヘッダ
キャッシュとして利用可能期限の指定する。Cache-controlが別途していされていた場合。Expiresは無視される
- Cache-Control + Date
controlでキャッシュの可否と期限を指定
- Last-modified + ETag
modifiedにリソースの最終更新日時を指定,ETagに特定バージョンを示す文字列を指定
- `Vary`でキャッシュさせる単位（対象)を指定
### apiセキュリティ設計
- XSS対策
    - レスポンスヘッダの追加(X-XSS-ProtectionやX-Frame-Optionsなど) 
- CSRF対策
    - 許可しないアクセス元からを拒否 
        `X-API-Key`(独自ヘッダ)や`Authentication`を用いる
    - 攻撃者に推測されにくいトークンの発行/照合処理を実装 
        `X-CSRF-TOKEN`(独自ヘッダ)を用いる
- HTTP対策
    - HTTPSを利用する
- JWT対策
    - ヘッダのalgにnone以外を指定し暗号化する
    - ペイロードのaudに想定する利用者を指定し、受信時にオーディエンスが正しいか検証を行う

## JSONPについて
通常は、あるオリジン(site-a.example.com)から別オリジン(site-b.example.com)で生成されたJSONを取り出そうとしても`同一生成ポリシー`によりアクセス拒否される。これをコールバック関数を用いて解決したのがJSONPである。
### 同一生成ポリシーとは
クロスサイトリクエストフォージェリ(CSRF)等のセキュリティ攻撃を防止するために、異なるオリジンのリソースにアクセス制限をかけるもの。 

つまり、JSONPを用いるとセキュリティ面はJSONより劣ることになる。
# 次やること
- 課題LGTMされたらRails
# 感じたこと
- JSONPについて個人的に調べておいて良かった。本教材だと詳しく説明されていないのでJSONの上位互換と勘違いするところだった。
### 学習時間
6h ほど
累計:340h



